require.config({paths:{"jquery-ui":"/blocks/bgwidget/lib/jquery-ui-1.14.1.custom/jquery-ui-wrapper",chatConfig:"/blocks/bgwidget/amd/src/chatConfig"},shim:{"jquery-ui":{deps:["jquery"],exports:"jQuery.ui"}}}),define("block_bgwidget/bgwidget",["jquery","jquery-ui","chatConfig"],(function($,ui,chatConfigModule){const chatConfig=chatConfigModule.chatConfig;function handlePin(){$("#unpinned-message").hide(),$("#chat-widget").draggable("destroy"),$("#chat-widget").resizable("destroy"),$("#chat-widget").css({position:"static",maxHeight:chatConfig.DEFAULT_WIDGET_DIMENSIONS.MAX_HEIGHT_PINNED,height:"100%",width:"100%"}),$("#chat-move-toggle").find("i").removeClass("unpinned").addClass("pinned")}function initializeChat(){const data={bot_id:chatConfig.bot_id,env:chatConfig.env,channel:chatConfig.CHANNEL_ACRONYM,username:stringToHex(chatConfig.user_name)};sendPostRequest(chatConfig.api_base_url+"/secure/api/connect",data,handleChatConnectSuccess,(function(){showError(chatConfig.CONECTION_FAILURE_MESSAGE)}),chatConfig.api_token)}function handleChatConnectSuccess(connectResponse){chatConfig.token=connectResponse.data.token,sessionStorage.setItem(chatConfig.tokenKey,chatConfig.token);const initialMessage=connectResponse.data.initial_response||chatConfig.SUCCESS_CONECTION_MESSAGE;$("#loading-icon").css("display","none"),addMessage(chatConfig.bot_name,initialMessage,!1),storeMessage(chatConfig.bot_name,initialMessage,!1)}function handleSendMessage(){const userMessage=$("#chat-input").val().trim();if(""===userMessage)return;addMessage(chatConfig.user_name,userMessage,!0),storeMessage(chatConfig.user_name,userMessage,!0);const data={user_input:userMessage,env:chatConfig.env};sendPostRequest(chatConfig.api_base_url+"/secure/api/message",data,(function(botResponse){addMessage(chatConfig.bot_name,botResponse.data.text,!1),storeMessage(chatConfig.bot_name,botResponse.data.text,!1)}),(function(){showError(chatConfig.SEND_MESSAGE_FAILURE_MESSAGE)})),$("#chat-input").val("")}function sendPostRequest(url,data,onSuccess,onError,authToken){$.ajax({url:url,type:"POST",contentType:"application/json",headers:{Authorization:authToken?"Bearer "+authToken:"Bearer "+chatConfig.token},data:JSON.stringify(data),success:function(response){onSuccess&&onSuccess(response)},error:function(){onError&&onError()}})}function addMessage(sender,content,isUser){const messageDiv=$("<div></div>").addClass("message p-2 mb-2 rounded").html("<strong>"+sender+":</strong> "+content);isUser?messageDiv.addClass("bg-primary text-white"):messageDiv.addClass("bg-light text-dark"),$("#chat-messages").append(messageDiv),$("#chat-messages").scrollTop($("#chat-messages")[0].scrollHeight)}function storeMessage(sender,content,isUser){chatConfig.messages.push({sender:sender,content:content,isUser:isUser}),sessionStorage.setItem(chatConfig.messagesKey,JSON.stringify(chatConfig.messages))}function showError(errorMessage){addMessage(chatConfig.bot_name,errorMessage,!1)}function stringToHex(str){if(!str)return"";let hex="";for(let i=0;i<str.length;i++)hex+=str.charCodeAt(i).toString(16);return hex}return{init:function(){chatConfigModule.setChatConfig(),chatConfig.token=sessionStorage.getItem(chatConfig.tokenKey)||"",chatConfig.messages=JSON.parse(sessionStorage.getItem(chatConfig.messagesKey))||[],function(){const unpinnedWidth=sessionStorage.getItem("widgetWidth")||chatConfig.DEFAULT_WIDGET_DIMENSIONS.WIDTH,unpinnedHeight=sessionStorage.getItem("widgetHeight")||chatConfig.DEFAULT_WIDGET_DIMENSIONS.HEIGHT;!function(unpinnedWidth,unpinnedHeight){$("#chat-move-toggle").on("click",(function(){chatConfig.isPinned=!chatConfig.isPinned,chatConfig.isPinned?handlePin():function(unpinnedWidth,unpinnedHeight){$("#unpinned-message").show();let savedPosition=JSON.parse(sessionStorage.getItem("widgetPosition"));const savedWidth=sessionStorage.getItem("widgetWidth")||unpinnedWidth,savedHeight=sessionStorage.getItem("widgetHeight")||unpinnedHeight;savedPosition||(savedPosition=function(savedWidth,savedHeight){const windowWidth=$(window).width(),windowHeight=$(window).height(),width=parseFloat(savedWidth)||0,height=parseFloat(savedHeight)||0;return{top:windowHeight/2-height/2,left:windowWidth/2-width/2}}(savedWidth,savedHeight));$("#chat-widget").draggable({containment:"window",scroll:!1,stop:function(event,ui){sessionStorage.setItem("widgetPosition",JSON.stringify(ui.position))}}),$("#chat-widget").resizable({handles:"n, e, s, w, ne, se, sw, nw",stop:function(event,ui){sessionStorage.setItem("widgetWidth",ui.size.width),sessionStorage.setItem("widgetHeight",ui.size.height)}}),$("#chat-widget").css({position:"fixed",width:savedWidth,height:savedHeight,top:savedPosition.top,left:savedPosition.left,maxHeight:chatConfig.DEFAULT_WIDGET_DIMENSIONS.MAX_HEIGHT_UNPINNED}),$("#chat-move-toggle").find("i").removeClass("pinned").addClass("unpinned")}(unpinnedWidth,unpinnedHeight)}))}(unpinnedWidth,unpinnedHeight)}(),chatConfig.messages.length>0&&chatConfig.messages.forEach((function(message){addMessage(message.sender,message.content,message.isUser)})),chatConfig.token||initializeChat(),$("#chat-send").on("click",(function(){handleSendMessage()})),$("#chat-input").on("keypress",(function(e){13===e.which&&handleSendMessage()})),$("#chat-reset").on("click",(function(){$("#chat-messages .message").remove(),$("#loading-icon").css("display","block"),sessionStorage.removeItem(chatConfig.tokenKey),sessionStorage.removeItem(chatConfig.messagesKey),chatConfig.token="",chatConfig.messages=[],initializeChat()})),$("#theme_boost-drawers-blocks").on("click",".icon.fa-xmark",(function(){chatConfig.isPinned||(handlePin(),chatConfig.isPinned=!0)}))}}}));

//# sourceMappingURL=bgwidget.min.js.map